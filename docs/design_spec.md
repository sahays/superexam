# SuperExam Design Specification & Best Practices

This document outlines the architectural patterns, naming conventions, and coding standards for the SuperExam project.

## 1. General Principles
- **Strict Typing:** Leverage Rust's type system and Dart's sound null safety. Avoid `dynamic` or `Any` unless absolutely necessary.
- **Source of Truth:** Protobuf definitions (`.proto`) are the contract between Frontend and Backend.
- **Error Handling:** Errors should be strictly typed where possible. The API communicates errors via gRPC status codes.

## 2. API Design (Protobuf)
- **Naming:**
    - Services: `PascalCase` (e.g., `IngestionService`).
    - RPCs: `PascalCase` (Verb + Noun, e.g., `UploadPdf`, `GetExam`).
    - Messages: `PascalCase` (e.g., `ExamSession`).
    - Fields: `snake_case` (e.g., `exam_id`, `created_at`).
- **Structure:**
    - Every RPC request message should be unique to that RPC (e.g., `CreateExamRequest`), even if currently empty or simple, to allow future expansion without breaking changes.
    - Use `oneof` for mutually exclusive states (e.g., `UploadRequest` payload).

## 3. Backend Architecture (Rust)
The backend implementation must strictly adhere to a **Layered Architecture** inspired by Spring Boot patterns to ensure separation of concerns and maintainability.

- **Framework:** `tonic` (gRPC), `tokio` (Async Runtime).

### Layered Structure
- **Controller Layer (Interface):**
  - Implemented as **gRPC Service** handlers.
  - Responsible for request validation and mapping Protobuf messages to internal DTOs.
  - Delegates business logic to the Service layer.
- **Service Layer (Business Logic):**
  - Contains all core application logic.
  - Operates on **DTOs (Data Transfer Objects)** and Domain Entities.
  - Completely decoupled from the transport layer (gRPC/HTTP) and data access details.
- **Repository Layer (Data Access):**
  - Handles all interactions with **Google Cloud Firestore**.
  - Abstracts query logic and schema mapping.
  - Returns Domain Entities to the Service layer.
- **DTOs:**
  - Distinct Rust structs used to pass data between layers, ensuring the API contract (Protobuf) and Database Schema (Firestore) can evolve independently.

### Implementation Details
- **Project Structure:**
    - `src/main.rs`: Entry point, server configuration.
    - `src/db.rs`: Database connection and generic helpers.
    - `src/services/`: Implementation of gRPC traits (Controller Layer).
        - `src/services/ingestion.rs`
        - `src/services/exam.rs`
    - `src/models/`: Internal domain models and DTOs.
- **Naming:**
    - Files: `snake_case.rs`.
    - Structs/Enums: `PascalCase`.
    - Functions/Variables: `snake_case`.
    - Constants: `SCREAMING_SNAKE_CASE`.
- **Database (Firestore):**
    - Collection names: `kebab-case` (e.g., `exam-sessions`, `questions`).
    - Use `serde` for serialization.
    - Document IDs: Use UUIDs generated by the backend or Firestore's auto-id if creation order doesn't matter.

## 4. Frontend Architecture (Flutter Web)
The frontend will be designed as a **SaaS-style Admin Dashboard**, prioritizing a rich, responsive, and visually engaging user experience, built on an MVVM-style architecture.

### Architecture & Structure
- **Pattern:** MVVM-style with Repository pattern.
    - **UI Layer (`lib/ui`):** Widgets and Pages. Purely presentational.
    - **State Layer (`lib/providers`):** Application state management (using `Riverpod` or `Provider`).
    - **Service/Repository Layer (`lib/services`):** gRPC clients and data transformation.
- **Directory Structure:**
    ```text
    lib/
    ├── main.dart
    ├── proto/          # Generated gRPC code
    ├── services/       # gRPC Client wrappers
    ├── models/         # Dart-specific models (if needed extensions over Proto)
    ├── providers/      # State management
    ├── ui/
    │   ├── common/     # Reusable widgets (Buttons, Cards)
    │   ├── screens/    # Full page views (IngestionScreen, ExamScreen)
    │   └── theme/      # Colors, Typography
    └── utils/          # Helpers
    ```

### UX & Theming
- **Design Philosophy:** **"Luminous Data" & "Bento Box"**.
  - The interface treats data as a vibrant, glowing entity. Content is organized into a modular grid of self-contained rectangular "Bento" boxes.
  - **Dark Mode (Default):** "Neon Glassmorphism". Deep void backgrounds, glowing neon accents, and high-contrast data visualization.
  - **Light Mode:** "Clean Frosted Glass". Soft, airy backgrounds, crisp shadows, and frosted glass panels, maintaining the strict modular structure of the dark mode.

- **Design Tokens:**
  - **Color Palette (Dark Mode):**
    - **Background Base:** Linear Gradient `#0F111A` -> `#1A1D2D`.
    - **Surface/Cards:** `#151725` (Opacity: 0.65).
    - **Border:** `#FFFFFF` (Opacity: 0.12).
    - **Primary Text:** `#FFFFFF`.
    - **Secondary Text:** `#9CA3AF`.
    - **Accent (Action):** `#3B82F6` (Electric Blue).
    - **Ambient Glows:** Blue `#3B82F6` (Opacity: 0.15) & Purple `#8B5CF6` (Opacity: 0.15).
    - **Tech Grid Overlay:** `#FFFFFF` (Opacity: 0.03).
  - **Color Palette (Light Mode):**
    - **Background Base:** Linear Gradient `#F0F4F8` -> `#E2E8F0`.
    - **Surface/Cards:** `#FFFFFF` (Opacity: 0.6).
    - **Border:** `#FFFFFF` (Opacity: 0.8).
    - **Primary Text:** `#1F2937`.
    - **Secondary Text:** `#64748B`.
    - **Accent (Action):** `#2563EB` (Royal Blue).
    - **Ambient Glows:** Purple `#A78BFA` (Opacity: 0.15) & Orange `#FDBA74` (Opacity: 0.15).
    - **Tech Grid Overlay:** `#000000` (Opacity: 0.03).
  - **Typography:**
    - **Headings:** *Plus Jakarta Sans* (Weights: 700/Bold).
    - **Body:** *Inter* (Weights: 400/Regular, 500/Medium).
  - **Animations:**
    - **Entrance Fade:** Duration: `800ms`, Curve: `Curves.easeOut`.
    - **Hover Effects:** Duration: `200ms`, Curve: `Curves.easeInOut`.
  - **Component Styles:**
    - **Glass Blur:** `BackdropFilter` with `sigmaX: 20`, `sigmaY: 20`.
    - **Card Border Radius:** `24px`.
    - **Button/Input Border Radius:** `16px`.
    - **Shadows:** Deep, soft shadows (Blur Radius: `30px-40px`) to lift elements off the textured background.

### Layout & Components
- **Core Layout:** **Mobile-First Admin Dashboard Shell**.
  - **Structure:** A responsive layout featuring a **Collapsible Sidepanel** for navigation, a top **Navbar** for global actions (search, profile), and a central **Content Area**.
  - **Mobile Responsiveness:** The layout starts from mobile (single column, hidden navigation/drawer) and scales up to desktop (visible sidebar, grid layouts).
  - **Content Constraints:** 
    - **Mobile:** Content consumes 100% width with safe-area padding.
    - **Desktop:** The main content body is **max-width restricted to 1280px** to ensure readability.
  - **Inner Layout (Bento Grid):** Inside the content area, data is organized into the strict **Bento Grid** of modular containers. Each "box" is an independent widget (e.g., "Upload Zone", "Recent Exams", "Stats").
  - **Spacing:** Generous gaps (20px+) between modules to let the background "breathe".
- **Components:**
  - **Modules (Cards):** heavily rounded corners (`border-radius: 24px`).
  - **Glow Effects:** Use gradients to simulate "light sources" highlighting active areas (e.g., a blue glow pulsing behind the file upload drop zone).
  - **Data Visualization:**
    - Charts should use **Gradient Fills** that fade to transparent.
    - Lines should be thick and smooth (Bezier curves).
  - **Navigation:**
    - **Sidepanel:** Collapsible, glassmorphism-styled sidebar.
    - **Navbar:** Minimalist top bar adhering to the glass aesthetic.

### Best Practices
- **Naming:**
    - Files: `snake_case.dart`.
    - Classes: `PascalCase`.
    - Variables: `camelCase`.
- **gRPC Usage:**
    - Do not make gRPC calls directly inside Widgets. Delegate to a Service/Repository.
    - Handle `GrpcError` gracefully and show user-friendly Toasts/Snackbars.

## 5. Version Control
- **Commits:** Conventional Commits.
    - `feat: ...` for new features.
    - `fix: ...` for bug fixes.
    - `docs: ...` for documentation.
    - `chore: ...` for maintenance/config.