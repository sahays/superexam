# SuperExam Design Specification & Best Practices

This document outlines the architectural patterns, naming conventions, and coding standards for the SuperExam project.

## 1. General Principles
- **Strict Typing:** Leverage Rust's type system and Dart's sound null safety. Avoid `dynamic` or `Any` unless absolutely necessary.
- **Source of Truth:** Protobuf definitions (`.proto`) are the contract between Frontend and Backend.
- **Error Handling:** Errors should be strictly typed where possible. The API communicates errors via gRPC status codes.

## 2. API Design (Protobuf)
- **Naming:**
    - Services: `PascalCase` (e.g., `IngestionService`).
    - RPCs: `PascalCase` (Verb + Noun, e.g., `UploadPdf`, `GetExam`).
    - Messages: `PascalCase` (e.g., `ExamSession`).
    - Fields: `snake_case` (e.g., `exam_id`, `created_at`).
- **Structure:**
    - Every RPC request message should be unique to that RPC (e.g., `CreateExamRequest`), even if currently empty or simple, to allow future expansion without breaking changes.
    - Use `oneof` for mutually exclusive states (e.g., `UploadRequest` payload).

## 3. Backend (Rust)
- **Framework:** `tonic` (gRPC), `tokio` (Async Runtime).
- **Project Structure:**
    - `src/main.rs`: Entry point, server configuration.
    - `src/db.rs`: Database connection and generic helpers.
    - `src/services/`: Implementation of gRPC traits.
        - `src/services/ingestion.rs`
        - `src/services/exam.rs`
    - `src/models/`: Internal domain models (if diverging from Proto) or helpers to map Proto <-> Firestore.
- **Naming:**
    - Files: `snake_case.rs`.
    - Structs/Enums: `PascalCase`.
    - Functions/Variables: `snake_case`.
    - Constants: `SCREAMING_SNAKE_CASE`.
- **Database (Firestore):**
    - Collection names: `kebab-case` (e.g., `exam-sessions`, `questions`).
    - Use `serde` for serialization.
    - Document IDs: Use UUIDs generated by the backend or Firestore's auto-id if creation order doesn't matter.

## 4. Frontend (Flutter Web)
- **Architecture:** MVVM-style with Repository pattern.
    - **UI Layer (`lib/ui`):** Widgets and Pages. Purely presentational.
    - **State Layer (`lib/providers`):** Application state management (using `Riverpod` or `Provider`).
    - **Service/Repository Layer (`lib/services`):** gRPC clients and data transformation.
- **Directory Structure:**
    ```text
    lib/
    ├── main.dart
    ├── proto/          # Generated gRPC code
    ├── services/       # gRPC Client wrappers
    ├── models/         # Dart-specific models (if needed extensions over Proto)
    ├── providers/      # State management
    ├── ui/
    │   ├── common/     # Reusable widgets (Buttons, Cards)
    │   ├── screens/    # Full page views (IngestionScreen, ExamScreen)
    │   └── theme/      # Colors, Typography
    └── utils/          # Helpers
    ```
- **Naming:**
    - Files: `snake_case.dart`.
    - Classes: `PascalCase`.
    - Variables: `camelCase`.
- **gRPC Usage:**
    - Do not make gRPC calls directly inside Widgets. Delegate to a Service/Repository.
    - Handle `GrpcError` gracefully and show user-friendly Toasts/Snackbars.

## 5. Version Control
- **Commits:** Conventional Commits.
    - `feat: ...` for new features.
    - `fix: ...` for bug fixes.
    - `docs: ...` for documentation.
    - `chore: ...` for maintenance/config.
