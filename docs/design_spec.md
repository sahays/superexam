# SuperExam Design Specification & Best Practices

This document outlines the architectural patterns, naming conventions, and coding standards for the SuperExam project.

## 1. General Principles
- **Strict Typing:** Leverage Rust's type system and Dart's sound null safety. Avoid `dynamic` or `Any` unless absolutely necessary.
- **Source of Truth:** Protobuf definitions (`.proto`) are the contract between Frontend and Backend.
- **Error Handling:** Errors should be strictly typed where possible. The API communicates errors via gRPC status codes.

## 2. API Design (Protobuf)
- **Naming:**
    - Services: `PascalCase` (e.g., `IngestionService`).
    - RPCs: `PascalCase` (Verb + Noun, e.g., `UploadPdf`, `GetExam`).
    - Messages: `PascalCase` (e.g., `ExamSession`).
    - Fields: `snake_case` (e.g., `exam_id`, `created_at`).
- **Structure:**
    - Every RPC request message should be unique to that RPC (e.g., `CreateExamRequest`), even if currently empty or simple, to allow future expansion without breaking changes.
    - Use `oneof` for mutually exclusive states (e.g., `UploadRequest` payload).

## 3. Backend Architecture (Rust)
The backend implementation must strictly adhere to a **Layered Architecture** inspired by Spring Boot patterns to ensure separation of concerns and maintainability.

- **Framework:** `tonic` (gRPC), `tokio` (Async Runtime).

### Layered Structure
- **Controller Layer (Interface):**
  - Implemented as **gRPC Service** handlers.
  - Responsible for request validation and mapping Protobuf messages to internal DTOs.
  - Delegates business logic to the Service layer.
- **Service Layer (Business Logic):**
  - Contains all core application logic.
  - Operates on **DTOs (Data Transfer Objects)** and Domain Entities.
  - Completely decoupled from the transport layer (gRPC/HTTP) and data access details.
- **Repository Layer (Data Access):**
  - Handles all interactions with **Google Cloud Firestore**.
  - Abstracts query logic and schema mapping.
  - Returns Domain Entities to the Service layer.
- **DTOs:**
  - Distinct Rust structs used to pass data between layers, ensuring the API contract (Protobuf) and Database Schema (Firestore) can evolve independently.

### Implementation Details
- **Project Structure:**
    - `src/main.rs`: Entry point, server configuration.
    - `src/db.rs`: Database connection and generic helpers.
    - `src/services/`: Implementation of gRPC traits (Controller Layer).
        - `src/services/ingestion.rs`
        - `src/services/exam.rs`
    - `src/models/`: Internal domain models and DTOs.
- **Naming:**
    - Files: `snake_case.rs`.
    - Structs/Enums: `PascalCase`.
    - Functions/Variables: `snake_case`.
    - Constants: `SCREAMING_SNAKE_CASE`.
- **Database (Firestore):**
    - Collection names: `kebab-case` (e.g., `exam-sessions`, `questions`).
    - Use `serde` for serialization.
    - Document IDs: Use UUIDs generated by the backend or Firestore's auto-id if creation order doesn't matter.

## 4. Frontend Architecture (Flutter Web)
The frontend will be designed as a **SaaS-style Admin Dashboard**, prioritizing a rich, responsive, and visually engaging user experience, built on an MVVM-style architecture.

### Architecture & Structure
- **Pattern:** MVVM-style with Repository pattern.
    - **UI Layer (`lib/ui`):** Widgets and Pages. Purely presentational.
    - **State Layer (`lib/providers`):** Application state management (using `Riverpod` or `Provider`).
    - **Service/Repository Layer (`lib/services`):** gRPC clients and data transformation.
- **Directory Structure:**
    ```text
    lib/
    ├── main.dart
    ├── proto/          # Generated gRPC code
    ├── services/       # gRPC Client wrappers
    ├── models/         # Dart-specific models (if needed extensions over Proto)
    ├── providers/      # State management
    ├── ui/
    │   ├── common/     # Reusable widgets (Buttons, Cards)
    │   ├── screens/    # Full page views (IngestionScreen, ExamScreen)
    │   └── theme/      # Colors, Typography
    └── utils/          # Helpers
    ```

### UX & Theming
- **Design Philosophy:**
  - **Mobile-First:** Fully responsive layouts that adapt seamlessly from mobile screens to large desktop monitors.
  - **Theme:** Automatic switching between **Dark** and **Light** modes based on system settings.
- **Visuals & Styling:**
  - **Color Scheme:**
    - **Background:** Light Grey-Blue `#F0F4F8`.
    - **Primary Accent:** Vibrant Blue `#3B82F6`.
    - **Gradients:** Purple (`#A78BFA` -> `#8B5CF6`) and Warm Orange/Red (`#FDBA74` -> `#F87171`).
    - **Text:** Dark Charcoal `#1F2937` (Primary), Medium Grey `#6B7280` (Secondary).
    - **Functional:** Green `#22C55E` (Success), Red `#EF4444` (Error).
  - **Typography:**
    - **Headings:** *Plus Jakarta Sans* (Geometric, friendly).
    - **Body:** *Inter* (Clean, versatile, legible).

### Layout & Components
- **Core Layout:**
  - **Navigation:** Collapsible Sidebar (Drawer) for main navigation + Top Bar for global actions/profile.
  - **Content:** Card-based layout with adequate padding and distinct separation of sections.
- **Components:**
  - **Rich Interactions:** Buttons with ripple effects, cards with hover elevation, and smooth route transitions.
  - **Data Visualization:** Use charts (Bar, Pie, Line) to visualize exam results and history.
  - **Animations:** Subtle entrance animations for lists and loading states (shimmer effects).

### Best Practices
- **Naming:**
    - Files: `snake_case.dart`.
    - Classes: `PascalCase`.
    - Variables: `camelCase`.
- **gRPC Usage:**
    - Do not make gRPC calls directly inside Widgets. Delegate to a Service/Repository.
    - Handle `GrpcError` gracefully and show user-friendly Toasts/Snackbars.

## 5. Version Control
- **Commits:** Conventional Commits.
    - `feat: ...` for new features.
    - `fix: ...` for bug fixes.
    - `docs: ...` for documentation.
    - `chore: ...` for maintenance/config.